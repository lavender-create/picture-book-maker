// static/js/stories.js
// 物語データ（UTF-8）

window.STORIES = {

  red: {
    title: "あかずきん ふう",
    image: "/static/img/red_cover.png",
    lines: [
      "むかしむかし、あかい ずきんの こが いました。",
      "あるひ、おばあさんの いえへ おとどけものに でかけました。",
      "みちで おおかみが あらわれて、にこにこ こえを かけました。",
      "あかずきんは、つい おばあさんの いえを はなしてしまいました。",
      "おおかみは さきに おばあさんの いえへ いそぎました。",
      "そして おばあさんに へんそうして、ふとんに はいりました。",
      "あかずきんが つくと、へんなところに きづきます。",
      "『おめめが おおきいね』『それは きみを よく みるためさ』",
      "『おくちが おおきいね』『それは きみを たべるためさ！』",
      "そのとき、きこりが かけつけて たすけてくれました。",
      "おおかみは にげていって、もりは しずかに なりました。",
      "あかずきんは おばあさんに ぎゅっと だきつきました。",
      "『もう しらないひとに ついていかない』と ちかったのです。",
      "それからは みちくさを せず、あんしんして かえりました。"
    ]
  },

  pigs: {
    title: "3びきのこぶた ふう",
    image: "/static/img/pigs_cover.png",
    lines: [
      "むかしむかし、3びきの こぶたが いました。",
      "1ぴきめは わらの いえを つくりました。",
      "2ひきめは きの いえを つくりました。",
      "3びきめは れんがの いえを こつこつ つくりました。",
      "そこへ おおかみが やってきて、わらの いえを ふきとばしました。",
      "つぎに きの いえも ふきとばして しまいました。",
      "2ひきは 3びきめの れんがの いえへ にげこみました。",
      "おおかみは どんなに ふいても、いえは びくともしません。",
      "おおかみは えんとつから はいろうと しました。",
      "でも したでは なべが ぐつぐつ わいていました。",
      "おおかみは あつくて びっくりし、にげていきました。",
      "3びきは ほっとして、えがおに なりました。",
      "『じゅんびを すると、まもれるね』と まなびました。",
      "それから 3びきは なかよく くらしました。"
    ]
  },

  bremen: {
    title: "ブレーメンのおんがくたい ふう",
    image: "/static/img/bremen_cover.png",
    lines: [
      "むかしむかし、しごとをおえた ろばが いました。",
      "ろばは まちへ いく たびに でることに しました。",
      "みちで いぬに であい、いっしょに あるくことに しました。",
      "つぎに ねこ、にわとりも なかまに なりました。",
      "みんなで うたを うたいながら あるきます。",
      "よるに なり、あかりの ついた いえを みつけました。",
      "おそるおそる のぞくと、にぎやかな おとが きこえます。",
      "みんなは こころを あわせて えんそうしました。",
      "おとは もりじゅうに ひびきました。",
      "すると、いえは とても しずかに なりました。",
      "みんなは ほっと ひといき つきました。",
      "そのいえで やすむことに しました。",
      "なかまと いっしょなら こころも あたたかです。",
      "こうして みんなは しあわせに くらしました。"
    ]
  },

  peach: {
    title: "ももたろう ふう",
    image: "/static/img/peach_cover.png",
    lines: [
      "むかしむかし、おじいさんと おばあさんが いました。",
      "かわから どんぶらこ と おおきな ももが ながれてきました。",
      "ももを きると、なかから げんきな あかちゃんが でてきました。",
      "なまえは ももたろう です。",
      "おおきくなった ももたろうは おにたいじに でかけました。",
      "きびだんごを もって、いぬに あいました。",
      "さるにも きじにも だんごを わけました。",
      "3びきは なかまに なって ついてきました。",
      "おにがしまに つくと、おにが どなりました。",
      "でも みんなで ちからを あわせて たたかいました。",
      "おには まいって、あやまりました。",
      "たからものを たくさん かえしてくれました。",
      "ももたろうたちは たからを もって かえりました。",
      "まちは しあわせで いっぱいに なりました。"
    ]
  },

  red_oni: {
    title: "ないたあかおに ふう",
    image: "/static/img/red_oni_cover.png",
    lines: [
      "むかしむかし、あかおにさんは ともだちが ほしかった。",
      "でも みんなは おにときくと こわがって にげてしまった。",
      "あかおにさんは しょんぼりして ないてしまった。",
      "そこへ あおおにさんが そっと やってきた。",
      "あおおにさんは いいことを おもいついた。",
      "あおおにさんが わるものの ふりをして、あかおにさんが たすける さくせんだ。",
      "つぎのひ、あおおにさんは まちで わるいふりを した。",
      "みんなが こまっていると、あかおにさんが たすけにきた。",
      "みんなは あかおにさんに ありがとう と いった。",
      "あかおにさんの こころは ぽかぽかに なった。",
      "でも あおおにさんは そっと まちを はなれていった。",
      "あかおにさんは さがして、おてがみを かいた。",
      "『ほんとうの ともだちって、こういうことなんだね』",
      "あおおにさんは どこかで にっこり わらっていた。"
    ]
  }
};

let currentIndex = 0;
let currentStoryKey = null;

window.startStory = function (storyKey) {
  if (!STORIES[storyKey]) {
    const area = document.getElementById("storyArea");
    if (area) area.textContent = "準備中…";
    return;
  }
  currentStoryKey = storyKey;
  currentIndex = 0;
  showLine();
};

function showLine() {
  const story = STORIES[currentStoryKey];
  if (!story) return;

  if (currentIndex >= story.lines.length) return;

  const text = story.lines[currentIndex];

  const area = document.getElementById("storyArea");
  if (area) area.textContent = text;

  // ✅ AI音声で読み上げ
  if (typeof window.playAIvoice === "function") {
    window.playAIvoice(text);
  }

  currentIndex++;
}

window.nextLine = function () {
  showLine();
};
